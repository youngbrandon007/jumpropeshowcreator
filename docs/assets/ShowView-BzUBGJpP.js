import{G as M,B as R,L as V,u as L,a as T}from"./ButtonSolid-DWKienDH.js";import{g as O,h as P,i as D,d as F,c as E,a as i,b as h,e as v,w as y,u as w,F as $,j,o as b,t as _}from"./index-CcloLO3_.js";import{_ as z}from"./TabReference.vue_vue_type_script_setup_true_lang-DRT2XkRF.js";function I(n){return n.trim().toLowerCase()}function k(n){const s=new Map,o=new Map;let a=0;return n.forEach(e=>{s.set(e,a),o.set(a,e),a+=1}),{itemToIndex:s,indexToItem:o}}function G(n){const s=new Set(n.flatMap(l=>l.entry.people.map(I))),{itemToIndex:o,indexToItem:a}=k(s),e=new Set(n.map(l=>I(l.entry.event))),{itemToIndex:t,indexToItem:r}=k(e);return{processedEntries:n.map((l,c)=>[c,t.get(I(l.entry.event)),l.entry.percentage??-1].concat(l.entry.people.map(u=>o.get(I(u))))),allPeople:s,personToIndex:o,indexToPerson:a,allEvents:e,eventToIndex:t,indexToEvent:r}}function J(n,s,o,a=0){let e=0;return n.forEach((t,r)=>{const p=r+a;e+=W(t,s,o,p);const l=t[1];s[l]=p;for(let c=3;c<t.length;c++){const u=t[c];o[u]=p}}),e}function W(n,s,o,a){let e=0;const t=n[1];s[t]!==-1&&(e+=C(s[t]-a));for(let r=3;r<n.length;r++){const p=n[r];o[p]!==-1&&(e+=C(o[p]-a))}return e}function C(n){return Math.log2(Math.abs(n))}function H(n,s){const o=[],a=s.map(t=>t),e=crypto.getRandomValues(new Uint32Array(n.length));for(let t=0;t<n.length;t++)if(n[t]!==null)o.push(n[t]);else{const r=Math.floor(e[0]*a.length/4294967296);o.push(a.splice(r,1)[0])}return o}function K(n,s,o,a,e,t){if(n[s]!==null)throw Error("Internal Error in findNextBestIndexRandomly()");let r=-1,p=-1;for(let l=0;l<o.length;l++){const c=n.map(m=>m);c[s]=o[l];const u=o.filter((m,x)=>x!==l);let f=0;for(let m=0;m<a;m++){const x=H(c,u),S=J(x,Array(e).fill(-1),Array(t).fill(-1));f+=S}f>r&&(r=f,p=l)}return p}function q(n){const{processedEntries:s,personToIndex:o,indexToPerson:a,allPeople:e,allEvents:t,eventToIndex:r,indexToEvent:p}=G(n),l=[],c=[];s.forEach(d=>{d[2]!==-1?c.push(d):l.push(d)}),c.sort((d,g)=>d[0]-g[0]);const u=Array(n.length).fill(null);let f=0;for(let d=0;d<u.length;d++){const g=c.length-f;if(g===0)break;const B=u.length-d,A=100*d/(u.length-1)+.01;(B<=g||c[f][2]<=A)&&(u[d]=c[f],f++)}const m=100,x=performance.now();for(let d=0;d<u.length;d++)if(u[d]===null){const g=K(u,d,l,m,t.size,e.size);u[d]=l.splice(g,1)[0]}const S=performance.now()-x;console.log("Created show in "+S.toFixed(3)+" ms.");const N=u.map(d=>n[d[0]]);return{allPeople:e,personToIndex:o,indexToPerson:a,allEvents:t,eventToIndex:r,indexToEvent:p,result:N}}const Q=O("show",()=>{let n=[];try{n=JSON.parse(localStorage.getItem("show")??"[]")}catch(t){console.error(t)}const s=P(n);D(s,t=>{localStorage.setItem("show",JSON.stringify(t))});function o(t){s.value=t.map(r=>({title:r.name!==""?r.name:r.event+" - "+r.people.join(", "),entry:r}))}function a(){const t=q(s.value);s.value=t.result}function e(){const t=M({useKeysAsHeaders:!0,filename:"show"}),r=R(t)(s.value.map(p=>({title:p.title,event:p.entry.event,people:p.entry.people.reduce((l,c)=>l.length>0?l+", "+c:c,"")})));V(t)(r)}return{show:s,reset:o,generate:a,downloadCsv:e}}),X={class:"px-4 sm:px-6 lg:px-8"},Y={class:"sm:flex sm:items-center"},Z={class:"sm:flex-auto"},U={class:"mt-2 text-sm text-gray-700"},ee={class:"mt-8 flow-root"},te={class:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},ne={class:"inline-block min-w-full py-2 align-middle"},oe={class:"flex flex-row justify-center p-2 gap-2"},se={class:"min-w-full divide-y divide-gray-300"},re={class:"divide-y divide-gray-200 bg-white"},le={class:"whitespace-nowrap py-2 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 lg:pl-8"},ce=F({__name:"ShowView",setup(n){const s=L(),o=Q();return(a,e)=>(b(),E("div",X,[i("div",Y,[i("div",Z,[e[6]||(e[6]=i("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Show",-1)),i("p",U,[e[4]||(e[4]=h("First go to the ")),v(z,{to:"/entries"},{default:y(()=>e[3]||(e[3]=[h("Entries")])),_:1}),e[5]||(e[5]=h(" tab and add the entries to your show. Then click 'Import Entries and Reset Show' to load in your entries from the other tab. Then click 'Generate' to create an order where like event types and people are spaced out."))])])]),i("div",ee,[i("div",te,[i("div",ne,[i("div",oe,[v(T,{onClick:e[0]||(e[0]=t=>w(o).reset(w(s).getProcessedValue()))},{default:y(()=>e[7]||(e[7]=[h("Import Entries and Reset Show")])),_:1}),v(T,{onClick:e[1]||(e[1]=t=>w(o).generate())},{default:y(()=>e[8]||(e[8]=[h("Generate")])),_:1}),e[10]||(e[10]=i("div",{class:"grow"},null,-1)),v(T,{onClick:e[2]||(e[2]=t=>w(o).downloadCsv())},{default:y(()=>e[9]||(e[9]=[h("Download")])),_:1})]),i("table",se,[e[11]||(e[11]=i("thead",null,[i("tr",null,[i("th",{scope:"col"},[i("span",{class:"sr-only"},"Number")]),i("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 lg:pl-8"},"Title"),i("th",{scope:"col",class:"relative py-3.5 pl-3 pr-4 sm:pr-6 lg:pr-8"},[i("span",{class:"sr-only"},"Options")])])],-1)),i("tbody",re,[(b(!0),E($,null,j(w(o).show,(t,r)=>(b(),E("tr",{key:r},[i("td",null,_(r+1),1),i("td",le,_(t.title),1)]))),128))])])])])])]))}});export{ce as default};
