import{s as G,g as Y,r as q,G as K,B as Q,L as X,u as Z,a as P,d as ee}from"./vuedraggable.umd-YTPhQrJX.js";import{o as S,c as _,a as t,g as B,h as U,i as te,d as F,u as z,j as ne,w as M,k as o,e as v,l as R,G as se,r as oe,Y as le,S as re,m as ie,n as ae,v as de,p as T,b as y,t as f,F as k,q as C,s as O,x as $}from"./index-Bv9PQmFy.js";import{_ as ue}from"./TabReference.vue_vue_type_script_setup_true_lang-mKbQ1oTP.js";function D(i,a){return S(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"})])}function ge(i,a,n,r,g){let p=0;return i.forEach((l,m)=>{const d=m+r;p+=me(l,a,n,d,g);const b=l[1];a[b]=d;for(let h=3;h<l.length;h++){const c=l[h];n[c]=d}}),p}function me(i,a,n,r,g){let p=0;const l=i[1];a[l]!==-1&&(p+=g.event(a[l]-r));for(let m=3;m<i.length;m++){const d=i[m];n[d]!==-1&&(p+=g.person(n[d]-r))}return p}const V={encourageEventMinimumSpacing:2,encourageEventMinimumSpacingStrength:4,encouragePersonMinimumSpacing:2,encouragePersonMinimumSpacingStrength:8,personSpacingMultiplier:10,eventSpacingMultiplier:5};function pe(i){return{event:a=>{const n=Math.abs(a);return Math.log(n+1)*i.eventSpacingMultiplier+(n>i.encourageEventMinimumSpacing?i.encourageEventMinimumSpacingStrength:0)},person:a=>{const n=Math.abs(a);return Math.log(n+1)*i.personSpacingMultiplier+(n>i.encouragePersonMinimumSpacing?i.encouragePersonMinimumSpacingStrength:0)}}}function ce(i,a,n,r,g,p,l){if(i[a]!==null)throw Error("Internal Error in findNextBestIndexRandomly()");let m=-1,d=-1;for(let b=0;b<n.length;b++){const h=i.map(s=>s);h[a]=n[b];const c=n.filter((s,u)=>u!==b);let e=0;for(let s=0;s<r;s++){const u=Y(h,c),x=ge(u,Array(g).fill(-1),Array(p).fill(-1),0,l);e+=x}e>m&&(m=e,d=b)}return d}function ve(i,a,n){const{processedEntries:r,personToIndex:g,indexToPerson:p,allPeople:l,allEvents:m,eventToIndex:d,indexToEvent:b}=G(i),h=[],c=[];r.forEach(w=>{w[2]!==-1?c.push(w):h.push(w)}),c.sort((w,I)=>w[0]-I[0]);const e=Array(i.length).fill(null);let s=0;for(let w=0;w<e.length;w++){const I=c.length-s;if(I===0)break;const J=e.length-w,W=100*w/(e.length-1)+.01;(J<=I||c[s][2]<=W)&&(e[w]=c[s],s++)}const u=a.iterations,x=performance.now();for(let w=0;w<e.length;w++)if(e[w]===null){const I=ce(e,w,h,u,m.size,l.size,n);e[w]=h.splice(I,1)[0]}const N=performance.now()-x;console.log("Created show in "+N.toFixed(3)+" ms.");const H=e.map(w=>i[w[0]]);return{allPeople:l,personToIndex:g,indexToPerson:p,allEvents:m,eventToIndex:d,indexToEvent:b,result:H}}const L={name:"random",iterations:100};function xe(i,a,n){const r=pe(n);switch(a.name){case"random":default:return ve(i,a,r)}}function A(i,a){let n=JSON.parse(localStorage.getItem(i)??"null")??a;const r=B(n);return U(r,g=>{localStorage.setItem(i,JSON.stringify(g))}),r}const fe=te("show",()=>{let i=A("show",[]);const a=A("generatorSettings",L),n=A("evaluatorSettings",V);function r(l){i.value=l.map(m=>({id:q(),title:m.name!==""?m.name:m.event+" - "+m.people.join(", "),entry:m}))}function g(){const l=xe(i.value,a.value,n.value);i.value=l.result}function p(){const l=K({useKeysAsHeaders:!0,filename:"show"}),m=Q(l)(i.value.map(d=>({title:d.title,event:d.entry.event,people:d.entry.people.reduce((b,h)=>b.length>0?b+", "+h:h,"")})));X(l)(m)}return{show:i,generatorSettings:a,evaluatorSettings:n,reset:r,generate:g,downloadCsv:p}}),we={class:"fixed inset-0 z-10 w-screen overflow-y-auto"},he={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Se=F({__name:"CustomDialog",props:{open:{default:!0},openModifiers:{}},emits:["update:open"],setup(i){const a=z(i,"open");return(n,r)=>(S(),ne(o(re),{as:"template",show:a.value},{default:M(()=>[v(o(le),{class:"relative z-50",onClose:r[0]||(r[0]=g=>a.value=!1)},{default:M(()=>[v(o(R),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:M(()=>r[1]||(r[1]=[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])),_:1}),t("div",we,[t("div",he,[v(o(R),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:M(()=>[v(o(se),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm sm:p-6"},{default:M(()=>[oe(n.$slots,"default")]),_:3})]),_:3})])])]),_:3})]),_:3},8,["show"]))}}),be=["min","max"],E=F({__name:"InputSlider",props:ie({min:{},max:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(i){const a=z(i,"value");return(n,r)=>ae((S(),_("input",{type:"range","onUpdate:modelValue":r[0]||(r[0]=g=>a.value=g),min:n.min,max:n.max,class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"},null,8,be)),[[de,a.value]])}});function j(i){const a=G(i),n=ye(a),r=_e(a),g={};a.allEvents.forEach(l=>{g[l]=[]});for(let l=0;l<n.length;l++){const m=a.indexToEvent.get(l);for(let d=0;d<n[l].length;d++)d+1<n[l].length&&g[m].push({index:n[l][d],distanceToNext:n[l][d+1]-n[l][d],nextIndex:n[l][d+1]})}const p={};a.allPeople.forEach(l=>{p[l]=[]});for(let l=0;l<r.length;l++){const m=a.indexToPerson.get(l);for(let d=0;d<r[l].length;d++)p[m].push({index:r[l][d],distanceToNext:r[l][d+1]-r[l][d],nextIndex:r[l][d+1]})}return{distanceByPerson:p,distanceByEvent:g}}function ye({processedEntries:i,allEvents:a}){const n=Array(a.size).fill(0).map(()=>Array());for(let r=0;r<i.length;r++){const g=i[r];n[g[1]].push(r)}return n}function _e({processedEntries:i,allPeople:a}){const n=Array(a.size).fill(0).map(()=>Array());for(let r=0;r<i.length;r++){const g=i[r];for(let p=3;p<i[r].length;p++)n[g[p]].push(r)}return n}const Me={class:"px-4 sm:px-6 lg:px-8"},Ee={class:"sm:flex sm:items-center"},Ie={class:"sm:flex-auto"},Pe={class:"mt-2 text-sm text-gray-700"},ke={class:"mt-8 flow-root"},Ne={class:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},Te={class:"inline-block min-w-full py-2 align-middle"},Ce={class:"flex flex-row flex-wrap p-2 gap-2"},Be={class:"min-w-full divide-y divide-gray-300"},Ae={class:"handle"},Fe={class:"whitespace-nowrap py-2 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 lg:pl-8"},Re={class:"w-20"},Oe={key:0,class:"w-10 h-0 overflow-visible"},$e={class:"w-20"},De={key:0,class:"w-10 h-0 overflow-visible"},je={class:"flex flex-col gap-6 mt-10"},Ge={class:"flex flex-row items-center gap-2"},Ue={class:"w-4 text-right"},ze={class:"flex flex-col gap-2"},Ve={class:"mt-2 text-sm text-gray-700"},Le={class:"border-gray-400 border-t py-1 px-1.5"},He={class:"flex flex-row gap-2 items-center"},Je={class:"border-gray-400 border-2 rounded-md py-1 px-1.5"},We={class:"border-gray-400 border-2 rounded-md py-1 px-1.5"},Ye={class:"font-bold"},qe={class:"flex flex-row items-center gap-2"},Ke={class:"w-4 text-right"},Qe={class:"flex flex-col gap-2"},Xe={class:"mt-2 text-sm text-gray-700"},Ze={class:"border-gray-400 border-t py-1 px-1.5"},et={class:"flex flex-row gap-2 items-center"},tt={class:"border-gray-400 border-2 rounded-md py-1 px-1.5"},nt={class:"border-gray-400 border-2 rounded-md py-1 px-1.5"},st={class:"font-bold"},ot={class:"flex flex-col gap-8"},lt={class:"flex flex-col gap-4"},rt={class:"flex flex-row gap-4 items-center"},it={class:"w-24 text-right"},at={class:"flex flex-col gap-4"},dt={class:"flex flex-row gap-4 items-center"},ut={class:"w-24 text-right"},gt={class:"flex flex-row gap-4 items-center"},mt={class:"w-24 text-right"},pt={class:"flex flex-row gap-4 items-center"},ct={class:"w-24 text-right"},vt={class:"flex flex-col gap-4"},xt={class:"flex flex-row gap-4 items-center"},ft={class:"w-24 text-right"},wt={class:"flex flex-row gap-4 items-center"},ht={class:"w-24 text-right"},St={class:"flex flex-row gap-4 items-center"},bt={class:"w-24 text-right"},Et=F({__name:"ShowView",setup(i){const a=Z(),n=fe(),r=B(!1);U(n.show,c=>{j(c)});const g=T(()=>j(n.show)),p=B(1),l=B(2),m=T(()=>{const c=g.value.distanceByEvent,e={};return Object.entries(c).forEach(([s,u])=>{const x=u.filter(N=>N.distanceToNext<=p.value+1);x.length>0&&(e[s]=x)}),e}),d=T(()=>{const c=g.value.distanceByPerson,e={};return Object.entries(c).forEach(([s,u])=>{const x=u.filter(N=>N.distanceToNext<=l.value+1);x.length>0&&(e[s]=x)}),e}),b=T(()=>{const c={};return Object.entries(m.value).forEach(([e,s])=>{s.forEach(u=>{c[u.index]=u.distanceToNext})}),c}),h=T(()=>{const c={};return Object.entries(d.value).forEach(([e,s])=>{s.forEach(u=>{c.hasOwnProperty(u.index)||(c[u.index]=[]),c[u.index].push(u.distanceToNext)})}),c});return(c,e)=>(S(),_(k,null,[t("div",Me,[t("div",Ee,[t("div",Ie,[e[19]||(e[19]=t("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Show",-1)),t("p",Pe,[e[17]||(e[17]=y("First go to the ")),v(ue,{to:"/entries"},{default:M(()=>e[16]||(e[16]=[y("Entries")])),_:1}),e[18]||(e[18]=y(" tab and add the entries to your show. Then click 'Import Entries and Reset Show' to load in your entries from the other tab. Then click 'Generate' to create an order where like event types and people are spaced out."))])])]),t("div",ke,[t("div",Ne,[t("div",Te,[t("div",Ce,[v(P,{onClick:e[0]||(e[0]=s=>o(n).reset(o(a).getProcessedValue()))},{default:M(()=>e[20]||(e[20]=[y("Import Entries and Reset Show")])),_:1}),v(P,{onClick:e[1]||(e[1]=s=>o(n).generate())},{default:M(()=>e[21]||(e[21]=[y("Generate")])),_:1}),v(P,{onClick:e[2]||(e[2]=s=>r.value=!0)},{default:M(()=>e[22]||(e[22]=[y("Generator Settings")])),_:1}),e[24]||(e[24]=t("div",{class:"grow"},null,-1)),v(P,{onClick:e[3]||(e[3]=s=>o(n).downloadCsv())},{default:M(()=>e[23]||(e[23]=[y("Download")])),_:1})]),t("table",Be,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},[t("span",{class:"sr-only"},"Number")]),t("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 lg:pl-8"},"Title")])],-1)),v(o(ee),{class:"divide-y divide-gray-200 bg-white",list:o(n).show,"item-key":"id",tag:"tbody",handle:".handle"},{item:M(({element:s,index:u})=>[t("tr",null,[t("td",Ae,f(u+1),1),t("td",Fe,f(s.title),1),t("td",Re,[b.value.hasOwnProperty(u)?(S(),_("div",Oe,[t("div",{class:"relative z-50 border-r-8 border-r-amber-500 w-16",style:O({height:(38*b.value[u]).toFixed(2)+"px",borderRadius:"50%",borderColor:"rgb(79 70 229)"})},null,4)])):$("",!0)]),t("td",$e,[h.value.hasOwnProperty(u)?(S(),_("div",De,[(S(!0),_(k,null,C(h.value[u],x=>(S(),_("div",{class:"absolute z-50 border-r-8 border-r-amber-500 w-16",style:O({height:(38*x).toFixed(2)+"px",borderRadius:"50%",borderColor:"rgb(79 70 229)"})},null,4))),256))])):$("",!0)])])]),_:1},8,["list"])])])]),t("div",je,[e[34]||(e[34]=t("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Analysis",-1)),t("div",null,[t("div",Ge,[e[26]||(e[26]=t("h1",{class:"text-base leading-6 text-gray-900"},"Close Repeated Events ",-1)),e[27]||(e[27]=t("div",{class:"grow"},null,-1)),v(E,{min:0,max:10,value:p.value.toFixed(),"onUpdate:value":e[4]||(e[4]=s=>{p.value=Number(s)}),class:"w-40"},null,8,["value"]),t("p",Ue,"≤"+f(p.value),1)]),t("div",ze,[(S(!0),_(k,null,C(m.value,(s,u)=>(S(),_("div",null,[t("p",Ve,f(u),1),t("div",Le,[(S(!0),_(k,null,C(s,x=>(S(),_("p",He,[y(f(x.index+1),1),t("span",Je,f(o(n).show[x.index].title),1),v(o(D),{class:"w-12 h-6"}),y(" "+f(x.nextIndex+1),1),t("span",We,f(o(n).show[x.nextIndex].title),1),e[28]||(e[28]=t("span",{class:"w-6"},null,-1)),e[29]||(e[29]=y("Entries In-between: ")),t("span",Ye,f(x.distanceToNext-1),1)]))),256))])]))),256))])]),t("div",null,[t("div",qe,[e[30]||(e[30]=t("h1",{class:"text-base leading-6 text-gray-900"},"Close Repeated People ",-1)),e[31]||(e[31]=t("div",{class:"grow"},null,-1)),v(E,{min:0,max:10,value:l.value.toFixed(),"onUpdate:value":e[5]||(e[5]=s=>{l.value=Number(s)}),class:"w-40"},null,8,["value"]),t("p",Ke,"≤"+f(l.value),1)]),t("div",Qe,[(S(!0),_(k,null,C(d.value,(s,u)=>(S(),_("div",null,[t("p",Xe,f(u),1),t("div",Ze,[(S(!0),_(k,null,C(s,x=>(S(),_("p",et,[y(f(x.index+1),1),t("span",tt,f(o(n).show[x.index].title),1),v(o(D),{class:"w-12 h-6"}),y(" "+f(x.nextIndex+1),1),t("span",nt,f(o(n).show[x.nextIndex].title),1),e[32]||(e[32]=t("span",{class:"w-6"},null,-1)),e[33]||(e[33]=y("Entries In-between: ")),t("span",st,f(x.distanceToNext-1),1)]))),256))])]))),256))])])])])]),v(Se,{open:r.value,"onUpdate:open":e[15]||(e[15]=s=>r.value=s)},{default:M(()=>[t("div",ot,[t("div",lt,[e[38]||(e[38]=t("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Generator Settings",-1)),v(P,{onClick:e[6]||(e[6]=s=>{o(n).generatorSettings=o(L),o(n).evaluatorSettings=o(V)})},{default:M(()=>e[35]||(e[35]=[y("Reset All Settings")])),_:1}),t("div",null,[e[36]||(e[36]=t("label",{for:"iterations",class:"block text-sm font-medium leading-6 text-gray-900"},"Iterations ",-1)),e[37]||(e[37]=t("small",{class:"block text-xs text-gray-500 font-medium leading-6"},"(higher may take longer to run but will get a better result)",-1)),t("div",rt,[v(E,{id:"iterations",min:"10",max:"40",value:(Math.log10(o(n).generatorSettings.iterations)*10).toFixed(),"onUpdate:value":e[7]||(e[7]=s=>o(n).generatorSettings={...o(n).generatorSettings,iterations:10**(Number(s)/10)})},null,8,["value"]),t("p",it,f(Math.round(o(n).generatorSettings.iterations)),1)])])]),t("div",at,[e[43]||(e[43]=t("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Generator Event Settings",-1)),t("div",null,[e[39]||(e[39]=t("label",{for:"event_priority",class:"block text-sm font-medium leading-6 text-gray-900"},"Event Spacing Priority",-1)),t("div",dt,[v(E,{id:"event_priority",min:"0",max:"10",value:o(n).evaluatorSettings.eventSpacingMultiplier.toFixed(0),"onUpdate:value":e[8]||(e[8]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,eventSpacingMultiplier:Number(s)})},null,8,["value"]),t("p",ut,f(Math.round(o(n).evaluatorSettings.eventSpacingMultiplier)),1)])]),t("div",null,[e[40]||(e[40]=t("label",{for:"event_min_spacing",class:"block text-sm font-medium leading-6 text-gray-900"},"Event Minimum Spacing ",-1)),e[41]||(e[41]=t("small",{class:"block text-xs text-gray-500 font-medium leading-6"},"(will not guarantee this spacing but will encourage the algorithm)",-1)),t("div",gt,[v(E,{id:"event_min_spacing",min:"0",max:"10",value:o(n).evaluatorSettings.encourageEventMinimumSpacing.toFixed(0),"onUpdate:value":e[9]||(e[9]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,encourageEventMinimumSpacing:Number(s)})},null,8,["value"]),t("p",mt,f(Math.round(o(n).evaluatorSettings.encourageEventMinimumSpacing)),1)])]),t("div",null,[e[42]||(e[42]=t("label",{for:"event_min_spacing_strength",class:"block text-sm font-medium leading-6 text-gray-900"},"Event Minimum Spacing Priority",-1)),t("div",pt,[v(E,{id:"event_min_spacing_strength",min:"0",max:"10",value:o(n).evaluatorSettings.encourageEventMinimumSpacingStrength.toFixed(0),"onUpdate:value":e[10]||(e[10]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,encourageEventMinimumSpacingStrength:Number(s)})},null,8,["value"]),t("p",ct,f(Math.round(o(n).evaluatorSettings.encourageEventMinimumSpacingStrength)),1)])])]),t("div",vt,[e[48]||(e[48]=t("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Person Event Settings",-1)),t("div",null,[e[44]||(e[44]=t("label",{for:"person_priority",class:"block text-sm font-medium leading-6 text-gray-900"},"Person Spacing Priority",-1)),t("div",xt,[v(E,{id:"person_priority",min:"0",max:"10",value:o(n).evaluatorSettings.personSpacingMultiplier.toFixed(0),"onUpdate:value":e[11]||(e[11]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,personSpacingMultiplier:Number(s)})},null,8,["value"]),t("p",ft,f(Math.round(o(n).evaluatorSettings.personSpacingMultiplier)),1)])]),t("div",null,[e[45]||(e[45]=t("label",{for:"person_min_spacing",class:"block text-sm font-medium leading-6 text-gray-900"},"Person Minimum Spacing ",-1)),e[46]||(e[46]=t("small",{class:"block text-xs text-gray-500 font-medium leading-6"},"(will not guarantee this spacing but will encourage the algorithm)",-1)),t("div",wt,[v(E,{id:"person_min_spacing",min:"0",max:"10",value:o(n).evaluatorSettings.encouragePersonMinimumSpacing.toFixed(0),"onUpdate:value":e[12]||(e[12]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,encouragePersonMinimumSpacing:Number(s)})},null,8,["value"]),t("p",ht,f(Math.round(o(n).evaluatorSettings.encouragePersonMinimumSpacing)),1)])]),t("div",null,[e[47]||(e[47]=t("label",{for:"person_min_spacing_strength",class:"block text-sm font-medium leading-6 text-gray-900"},"Person Minimum Spacing Priority",-1)),t("div",St,[v(E,{id:"person_min_spacing_strength",min:"0",max:"10",value:o(n).evaluatorSettings.encouragePersonMinimumSpacingStrength.toFixed(0),"onUpdate:value":e[13]||(e[13]=s=>o(n).evaluatorSettings={...o(n).evaluatorSettings,encouragePersonMinimumSpacingStrength:Number(s)})},null,8,["value"]),t("p",bt,f(Math.round(o(n).evaluatorSettings.encouragePersonMinimumSpacingStrength)),1)])])]),v(P,{onClick:e[14]||(e[14]=s=>r.value=!1)},{default:M(()=>e[49]||(e[49]=[y("Done")])),_:1})])]),_:1},8,["open"])],64))}});export{Et as default};
